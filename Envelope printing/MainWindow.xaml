<Window x:Class="Envelope_printing.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:Envelope_printing"
        mc:Ignorable="d"
        Title="Печать конвертов" Height="600" Width="900"
        WindowStartupLocation="CenterScreen"
        Background="{DynamicResource AppBackground}"
        Icon="{DynamicResource AppLogo}">

    <Window.Resources>
        <!-- Конвертер для управления видимостью -->
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>

        <!-- Navigation button base, theme-aware -->
        <Style x:Key="NavButtonBaseStyle" TargetType="{x:Type ButtonBase}">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="HorizontalAlignment" Value="Stretch"/>
            <Setter Property="HorizontalContentAlignment" Value="Left"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="Height" Value="40"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Cursor" Value="Hand"/>
            <!-- Tooltips: show only when panel is collapsed -->
            <Setter Property="ToolTipService.IsEnabled" Value="True"/>
            <Setter Property="ToolTipService.Placement" Value="Right"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type ButtonBase}">
                        <Border Background="{TemplateBinding Background}" Padding="{TemplateBinding Padding}" CornerRadius="4">
                            <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{DynamicResource ButtonHoverBrush}"/>
                </Trigger>
                <DataTrigger Binding="{Binding DataContext.IsLeftPanelExpanded, RelativeSource={RelativeSource AncestorType=Window}}" Value="True">
                    <Setter Property="ToolTipService.IsEnabled" Value="False"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <!-- Конечные стили, которые наследуются от базового -->
        <Style x:Key="NavButtonStyle" TargetType="Button" BasedOn="{StaticResource NavButtonBaseStyle}"/>
        <Style x:Key="NavToggleButtonStyle" TargetType="ToggleButton" BasedOn="{StaticResource NavButtonBaseStyle}"/>

        <!-- Стиль для текста на кнопках, который будет скрываться -->
        <Style x:Key="NavButtonTextStyle" TargetType="TextBlock">
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Visibility" Value="Visible"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding DataContext.IsLeftPanelExpanded, RelativeSource={RelativeSource AncestorType=Window}}" Value="False">
                    <Setter Property="Visibility" Value="Collapsed"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <!-- При свернутой панели сужаем внутреннюю сетку кнопки до42px и центрируем её; добавляем правый внутренний отступ для головы бейджа -->
        <Style x:Key="CollapsedNavGridStyle" TargetType="Grid">
            <Setter Property="HorizontalAlignment" Value="Stretch"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding DataContext.IsLeftPanelExpanded, RelativeSource={RelativeSource AncestorType=Window}}" Value="False">
                    <Setter Property="Width" Value="42"/>
                    <Setter Property="HorizontalAlignment" Value="Center"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <!-- Root host contains Splash layer and App layer -->
    <Grid Background="{DynamicResource AppBackground}">
        <!-- Splash overlay -->
        <Grid x:Name="SplashGrid" Background="{DynamicResource AppBackground}">
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <StackPanel Grid.Row="1" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="16">
                <!-- Optional logo if added later as DynamicResource AppLogo -->
                <Image Width="72" Height="72" Margin="0,0,0,10" Source="{DynamicResource AppLogo}" Stretch="Uniform"/>
                <TextBlock Text="Печать конвертов" FontSize="22" FontWeight="SemiBold" HorizontalAlignment="Center"/>
                <TextBlock Text="Загрузка..." Margin="0,6,0,12" HorizontalAlignment="Center"/>
                <!-- Simple spinner -->
                <Grid Width="48" Height="48">
                    <Ellipse Width="48" Height="48" Stroke="{DynamicResource AccentBrush}" StrokeThickness="4" StrokeDashArray="23" RenderTransformOrigin="0.5,0.5">
                        <Ellipse.RenderTransform>
                            <RotateTransform x:Name="SpinnerRotate" Angle="0"/>
                        </Ellipse.RenderTransform>
                    </Ellipse>
                    <Grid.Triggers>
                        <EventTrigger RoutedEvent="Loaded">
                            <BeginStoryboard>
                                <Storyboard RepeatBehavior="Forever">
                                    <DoubleAnimation Storyboard.TargetName="SpinnerRotate" Storyboard.TargetProperty="Angle" From="0" To="360" Duration="0:0:1.2"/>
                                </Storyboard>
                            </BeginStoryboard>
                        </EventTrigger>
                    </Grid.Triggers>
                </Grid>
            </StackPanel>
        </Grid>

        <!-- App layer: original content wrapped and initially hidden -->
        <Grid x:Name="AppRoot" Visibility="Collapsed" Background="{DynamicResource AppBackground}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="{Binding LeftPanelWidth}"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- ЛЕВАЯ НАВИГАЦИОННАЯ ПАНЕЛЬ -->
            <Border Grid.Column="0" Background="{DynamicResource SurfaceBrush}" BorderBrush="{DynamicResource FieldBorderBrush}" BorderThickness="1" Margin="5" CornerRadius="8">
                <Border.Effect>
                    <DropShadowEffect ShadowDepth="2" Color="Gray" Opacity="0.15" BlurRadius="8"/>
                </Border.Effect>

                <!-- allow notification dot to overflow without clipping -->
                <Grid ClipToBounds="False">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <!-- Верхняя группа -->
                        <RowDefinition Height="*"/>
                        <!-- Распорка -->
                        <RowDefinition Height="Auto"/>
                        <!-- Нижняя группа -->
                    </Grid.RowDefinitions>

                    <StackPanel Grid.Row="0" Margin="4">
                        <Button Style="{StaticResource NavButtonStyle}" Command="{Binding ShowHomeCommand}" ToolTip="На главную">
                            <Grid Style="{StaticResource CollapsedNavGridStyle}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="42"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" FontFamily="Segoe MDL2 Assets" Text="&#xE80F;" VerticalAlignment="Center" HorizontalAlignment="Center" FontSize="16"/>
                                <TextBlock Grid.Column="1" Text="На главную" Style="{StaticResource NavButtonTextStyle}"/>
                            </Grid>
                        </Button>
                        <Button Style="{StaticResource NavButtonStyle}" Command="{Binding ShowPrintPreviewCommand}" FontWeight="Bold" ToolTip="Печать конвертов">
                            <Grid Style="{StaticResource CollapsedNavGridStyle}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="42"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <!-- Use mail icon for printing envelopes -->
                                <TextBlock Grid.Column="0" FontFamily="Segoe MDL2 Assets" Text="&#xE715;" VerticalAlignment="Center" HorizontalAlignment="Center" FontSize="16"/>
                                <TextBlock Grid.Column="1" Text="Печать конвертов" Style="{StaticResource NavButtonTextStyle}"/>
                            </Grid>
                        </Button>
                    </StackPanel>

                    <StackPanel Grid.Row="2" VerticalAlignment="Bottom" Margin="4">
                        <Button Style="{StaticResource NavButtonStyle}" Command="{Binding ShowRecipientEditorCommand}" ToolTip="База получателей">
                            <Grid Style="{StaticResource CollapsedNavGridStyle}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="42"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" FontFamily="Segoe MDL2 Assets" Text="&#xE716;" VerticalAlignment="Center" HorizontalAlignment="Center" FontSize="16"/>
                                <TextBlock Grid.Column="1" Text="База получателей" Style="{StaticResource NavButtonTextStyle}"/>
                            </Grid>
                        </Button>
                        <Button Style="{StaticResource NavButtonStyle}" Command="{Binding ShowTemplateDesignerCommand}" ToolTip="Дизайнер">
                            <Grid Style="{StaticResource CollapsedNavGridStyle}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="42"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" FontFamily="Segoe MDL2 Assets" Text="&#xE70F;" VerticalAlignment="Center" HorizontalAlignment="Center" FontSize="16"/>
                                <TextBlock Grid.Column="1" Text="Дизайнер" Style="{StaticResource NavButtonTextStyle}"/>
                            </Grid>
                        </Button>
                        <Button Style="{StaticResource NavButtonStyle}" Command="{Binding ShowSettingsCommand}" ToolTip="Настройки">
                            <Grid Style="{StaticResource CollapsedNavGridStyle}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="42"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid Grid.Column="0" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" ClipToBounds="False">
                                    <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE713;" VerticalAlignment="Center" HorizontalAlignment="Center" FontSize="16"/>
                                    <!-- Overlay canvas keeps icon centered while badge can occupy extra space -->
                                    <Canvas HorizontalAlignment="Center" VerticalAlignment="Center" Width="42" Height="42" IsHitTestVisible="False" ClipToBounds="False">
                                        <Ellipse Width="10" Height="10" Fill="#2B88D8" Stroke="White" StrokeThickness="1.2"
                                                 Canvas.Left="27" Canvas.Top="8">
                                            <Ellipse.Visibility>
                                                <Binding Path="HasUpdateAvailable" Converter="{StaticResource BoolToVis}"/>
                                            </Ellipse.Visibility>
                                        </Ellipse>
                                    </Canvas>
                                </Grid>
                                <TextBlock Grid.Column="1" Text="Настройки" Style="{StaticResource NavButtonTextStyle}"/>
                            </Grid>
                        </Button>
                        <Separator Margin="4"/>
                        <ToggleButton Style="{StaticResource NavToggleButtonStyle}" IsChecked="{Binding IsLeftPanelExpanded, Mode=TwoWay}" ToolTip="Свернуть/Развернуть панель">
                            <Grid Style="{StaticResource CollapsedNavGridStyle}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="42"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" FontFamily="Segoe MDL2 Assets" Text="&#xE700;" VerticalAlignment="Center" HorizontalAlignment="Center" FontSize="16"/>
                                <TextBlock Grid.Column="1" Text="Свернуть" Style="{StaticResource NavButtonTextStyle}"/>
                            </Grid>
                        </ToggleButton>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- ОБЛАСТЬ КОНТЕНТА -->
            <Border Grid.Column="1" Margin="0,5,5,5" CornerRadius="8" SnapsToDevicePixels="True" Background="Transparent">
                <Border Background="{DynamicResource SurfaceBrush}" BorderBrush="{DynamicResource FieldBorderBrush}" BorderThickness="1" CornerRadius="8">
                    <Border.Effect>
                        <DropShadowEffect ShadowDepth="2" Color="Gray" Opacity="0.15" BlurRadius="8"/>
                    </Border.Effect>
                    <ContentControl Content="{Binding CurrentView}" Margin="5"/>
                </Border>
            </Border>
        </Grid>
    </Grid>
</Window>